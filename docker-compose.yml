# MACHINE GENERATED from custom - DO NOT EDIT

version: 2
volumes:
  influxdb2:
  config:
  grafana:
  postgres:
  duplicati:
  esphome:
  code-server:
  www:
  wireshark:
  iot-home:
  nginx:
  mosquitto:
  plex:
  homeassistant:
  plex-media:
services:
  config:
    build: services/config
    restart: unless-stopped
    labels:
      io.balena.features.supervisor-api: 1
    volumes:
    - config:/service-config/config
  nginx:
    build: services/nginx
    restart: unless-stopped
    privileged: true
    labels:
      io.balena.features.supervisor-api: 1
    ports:
    - 80:80
    - 443:443
    depends_on:
    - config
    - jupyter
    volumes:
    - nginx:/etc/nginx
    - www:/service-config/www
  jupyter:
    build: services/jupyter
    restart: unless-stopped
    privileged: true
    network_mode: host
    labels:
      io.balena.features.dbus: 1
      io.balena.features.supervisor-api: 1
    environment:
    - DBUS_SYSTEM_BUS_ADDRESS=unix:path=/host/run/dbus/system_bus_socket
    - JUPYTER_PORT=8888
    volumes:
    - iot-home:/home/iot
    - influxdb2:/service-config/influxdb2
    - config:/service-config/config
    - grafana:/service-config/grafana
    - postgres:/service-config/postgres
    - duplicati:/service-config/duplicati
    - esphome:/service-config/esphome
    - code-server:/service-config/code-server
    - www:/service-config/www
    - wireshark:/service-config/wireshark
    - iot-home:/service-config/iot-home
    - nginx:/service-config/nginx
    - mosquitto:/service-config/mosquitto
    - plex:/service-config/plex
    - homeassistant:/service-config/homeassistant
    - plex-media:/service-config/plex-media
    expose:
    - 8888
  code-server:
    build: services/code-server
    restart: unless-stopped
    privileged: true
    environment:
    - PUID=1000
    - PGID=1000
    volumes:
    - code-server:/config
    - iot-home:/config/workspace
    - influxdb2:/service-config/influxdb2
    - config:/service-config/config
    - grafana:/service-config/grafana
    - postgres:/service-config/postgres
    - duplicati:/service-config/duplicati
    - esphome:/service-config/esphome
    - code-server:/service-config/code-server
    - www:/service-config/www
    - wireshark:/service-config/wireshark
    - iot-home:/service-config/iot-home
    - nginx:/service-config/nginx
    - mosquitto:/service-config/mosquitto
    - plex:/service-config/plex
    - homeassistant:/service-config/homeassistant
    - plex-media:/service-config/plex-media
    expose:
    - 8443
    depends_on:
    - config
  duplicati:
    build: services/duplicati
    restart: unless-stopped
    privileged: true
    environment:
    - PUID=0
    - PGID=0
    - CLI_ARGS=--webservice-interface=any
    volumes:
    - duplicati:/config
    - influxdb2:/service-config/influxdb2
    - config:/service-config/config
    - grafana:/service-config/grafana
    - postgres:/service-config/postgres
    - duplicati:/service-config/duplicati
    - esphome:/service-config/esphome
    - code-server:/service-config/code-server
    - www:/service-config/www
    - wireshark:/service-config/wireshark
    - iot-home:/service-config/iot-home
    - nginx:/service-config/nginx
    - mosquitto:/service-config/mosquitto
    - plex:/service-config/plex
    - homeassistant:/service-config/homeassistant
    - plex-media:/service-config/plex-media
    expose:
    - 8200
  smb:
    build: services/smb
    restart: unless-stopped
    privileged: true
    volumes:
    - influxdb2:/service-config/influxdb2
    - config:/service-config/config
    - grafana:/service-config/grafana
    - postgres:/service-config/postgres
    - duplicati:/service-config/duplicati
    - esphome:/service-config/esphome
    - code-server:/service-config/code-server
    - www:/service-config/www
    - wireshark:/service-config/wireshark
    - iot-home:/service-config/iot-home
    - nginx:/service-config/nginx
    - mosquitto:/service-config/mosquitto
    - plex:/service-config/plex
    - homeassistant:/service-config/homeassistant
    - plex-media:/service-config/plex-media
    ports:
    - 139:139
    - 445:445
  mosquitto:
    build: services/mosquitto
    restart: unless-stopped
    labels:
      io.balena.features.supervisor-api: 1
    ports:
    - 1883:1883
    - 9001:9001
    - 8883:8883
    - 9002:9002
    volumes:
    - mosquitto:/mosquitto
  wireshark:
    image: linuxserver/wireshark:2.4.5
    network_mode: host
    restart: unless-stopped
    cap_add:
    - NET_ADMIN
    environment:
    - PUID=1000
    - PGID=1000
    expose:
    - 3000
    volumes:
    - wireshark:/config
  balena-cli:
    build: services/balena-cli
    restart: unless-stopped
    privileged: true
    labels:
      io.balena.features.supervisor-api: 1
    environment:
    - JUPYTER_PORT=8891
    - SHELL=/bin/bash
    volumes:
    - iot-home:/home/iot
    - iot-home:/service-config/iot-home
    expose:
    - 8891
    depends_on:
    - jupyter
  plex:
    image: lscr.io/linuxserver/plex:latest
    restart: unless-stopped
    privileged: true
    network_mode: host
    volumes:
    - plex:/config
    - plex-media:/service-config/plex-media
    environment:
    - PUID=1000
    - PGID=1000
    - VERSION=docker
  homeassistant:
    build: services/homeassistant
    restart: unless-stopped
    privileged: true
    network_mode: host
    environment:
    - USER=iot
    - PUID=1000
    - PGID=1000
    - UMASK=007
    - DBUS_SYSTEM_BUS_ADDRESS=unix:path=/host/run/dbus/system_bus_socket
    labels:
      io.balena.features.dbus: 1
    expose:
    - 8123
    volumes:
    - homeassistant:/config
    - config:/service-config/config
  esphome:
    image: esphome/esphome
    restart: unless-stopped
    privileged: true
    network_mode: host
    volumes:
    - esphome:/config
  grafana:
    image: grafana/grafana-oss
    restart: unless-stopped
    ports:
    - 3001:3000
    volumes:
    - grafana:/var/lib/grafana
  influxdb:
    container_name: influxdb
    image: influxdb:2.4
    environment:
    - DOCKER_INFLUXDB_INIT_MODE=setup
    - DOCKER_INFLUXDB_INIT_USERNAME=hass
    - DOCKER_INFLUXDB_INIT_PASSWORD=h@rd_gue$$
    - DOCKER_INFLUXDB_INIT_ORG=hass
    - DOCKER_INFLUXDB_INIT_BUCKET=homeassistant
    - DOCKER_INFLUXDB_INIT_ADMIN_TOKEN=yu*&ljasgf24Au
    ports:
    - 8086:8086
    restart: unless-stopped
    volumes:
    - influxdb2:/var/lib/influxdb2
  postgres:
    image: postgres:14-alpine
    environment:
    - POSTGRES_DB=homeassistant
    - POSTGRES_USER=hass
    - POSTGRES_PASSWORD=h@rd_gue$$
    ports:
    - 5432:5432
    restart: unless-stopped
    volumes:
    - postgres:/var/lib/postgresql/data
